import { describe, it, expect } from "vitest"; import { ensureInsideWorkspace, toExtendedIfNeeded } from "../src/utils/security.js"; import path from "node:path"; describe("security helpers", () => { it("ensureInsideWorkspace allows paths inside root", () => { const ws = path.resolve("."); const inside = ensureInsideWorkspace("./src/index.ts", ws); expect(inside.startsWith(ws)).toBe(true); }); it("toExtendedIfNeeded returns extended path on Windows", () => { const p = toExtendedIfNeeded(path.resolve(".")); const extendedPrefix = "\\?\"; if (process.platform === "win32") { expect(p.startsWith(extendedPrefix)).toBe(true); } else { expect(p.startsWith(extendedPrefix)).toBe(false); } }); });